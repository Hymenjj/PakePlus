{"name":"hanime1","url":"https://hanime1.me/","showName":"hanime1","appid":"com.hanime1.app","icon":"","iconRound":true,"state":true,"single":true,"injectJq":true,"tauriApi":false,"devbug":true,"version":"0.0.2","preview":"desktop","platform":["1-1","1-2","2-1","2-2","3-1","3-2"],"width":800,"height":600,"desc":"","jsFile":[],"filterCss":"","customJs":"// Hanime1.me å¢å¼ºåŠŸèƒ½è„šæœ¬\n// ä¸ºç½‘ç«™æ·»åŠ å„ç§ä¾¿åˆ©åŠŸèƒ½\n\n(function() {\n    'use strict';\n    \n    // é…ç½®å¯¹è±¡\n    const config = {\n        downloadDir: localStorage.getItem('hanime_download_dir') || 'Downloads',\n        playbackSpeed: 1,\n        currentPlaylist: [],\n        currentIndex: 0,\n        isInPlaylist: false\n    };\n    \n    // åˆ›å»ºè®¾ç½®é¢æ¿\n    function createSettingsPanel() {\n        const panel = document.createElement('div');\n        panel.id = 'hanime-settings-panel';\n        panel.style.cssText = `\n            position: fixed;\n            top: 20px;\n            right: 20px;\n            width: 300px;\n            background: #2a2a2a;\n            border: 1px solid #444;\n            border-radius: 8px;\n            padding: 20px;\n            z-index: 10000;\n            color: white;\n            font-family: Arial, sans-serif;\n            display: none;\n        `;\n        \n        panel.innerHTML = `\n            <h3 style=\"margin-top: 0;\">è®¾ç½®</h3>\n            <div style=\"margin-bottom: 15px;\">\n                <label>ä¸‹è½½ç›®å½•:</label><br>\n                <div style=\"margin: 5px 0;\">\n                    <select id=\"preset-dir-select\" style=\"width: 100%; padding: 5px; background: #333; color: white; border: 1px solid #555; margin-bottom: 5px;\">\n                        <option value=\"\">é€‰æ‹©é¢„è®¾ç›®å½•...</option>\n                        <option value=\"Downloads\">Downloads</option>\n                        <option value=\"Desktop\">æ¡Œé¢ (Desktop)</option>\n                        <option value=\"Documents\">æ–‡æ¡£ (Documents)</option>\n                        <option value=\"Videos\">è§†é¢‘ (Videos)</option>\n                        <option value=\"D:\\\\Downloads\">D:\\\\Downloads</option>\n                        <option value=\"E:\\\\Downloads\">E:\\\\Downloads</option>\n                        <option value=\"C:\\\\Users\\\\${navigator.userAgent.includes('Windows') ? '%USERNAME%' : 'user'}\\\\Downloads\">ç”¨æˆ·ä¸‹è½½æ–‡ä»¶å¤¹</option>\n                        <option value=\"custom\">è‡ªå®šä¹‰è·¯å¾„...</option>\n                    </select>\n                </div>\n                <div style=\"margin: 5px 0;\">\n                    <button id=\"browse-dir-btn\" style=\"width: 100%; padding: 8px; background: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer; margin-bottom: 5px;\">\n                        ğŸ“ æµè§ˆé€‰æ‹©ç›®å½•\n                    </button>\n                    <input type=\"file\" id=\"dir-picker\" webkitdirectory directory style=\"display: none;\">\n                </div>\n                <input type=\"text\" id=\"download-dir-input\" value=\"${config.downloadDir}\" \n                       style=\"width: 100%; padding: 5px; background: #333; color: white; border: 1px solid #555;\" \n                       placeholder=\"è¾“å…¥è‡ªå®šä¹‰ä¸‹è½½è·¯å¾„...\">\n                <div style=\"margin-top: 5px; font-size: 11px; color: #aaa;\">\n                    ğŸ’¡ æç¤º: å¯é€‰æ‹©é¢„è®¾ç›®å½•æˆ–è¾“å…¥è‡ªå®šä¹‰è·¯å¾„\n                </div>\n            </div>\n            <button id=\"save-settings\" style=\"background: #007bff; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer;\">ä¿å­˜</button>\n            <button id=\"close-settings\" style=\"background: #6c757d; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; margin-left: 10px;\">å…³é—­</button>\n        `;\n        \n        document.body.appendChild(panel);\n        \n        // ç»‘å®šäº‹ä»¶\n        document.getElementById('preset-dir-select').onchange = (e) => {\n            const selectedValue = e.target.value;\n            const inputField = document.getElementById('download-dir-input');\n            \n            if (selectedValue && selectedValue !== 'custom') {\n                // å¤„ç†Windowsç¯å¢ƒå˜é‡\n                let processedPath = selectedValue;\n                if (selectedValue.includes('%USERNAME%')) {\n                    // åœ¨å®é™…ä½¿ç”¨æ—¶ï¼Œè¿™ä¸ªä¼šè¢«æµè§ˆå™¨æˆ–ä¸‹è½½ç®¡ç†å™¨å¤„ç†\n                    processedPath = selectedValue.replace('%USERNAME%', 'User');\n                }\n                inputField.value = processedPath;\n                inputField.style.backgroundColor = '#2a4a2a'; // ç»¿è‰²æç¤ºå·²é€‰æ‹©\n                \n                // 2ç§’åæ¢å¤åŸè‰²\n                setTimeout(() => {\n                    inputField.style.backgroundColor = '#333';\n                }, 2000);\n            } else if (selectedValue === 'custom') {\n                inputField.focus();\n                inputField.style.backgroundColor = '#4a4a2a'; // é»„è‰²æç¤ºè¾“å…¥è‡ªå®šä¹‰\n                \n                setTimeout(() => {\n                    inputField.style.backgroundColor = '#333';\n                }, 2000);\n            }\n        };\n        \n        // ç›®å½•é€‰æ‹©å™¨äº‹ä»¶\n        document.getElementById('browse-dir-btn').onclick = () => {\n            document.getElementById('dir-picker').click();\n        };\n        \n        document.getElementById('dir-picker').onchange = (e) => {\n            const files = e.target.files;\n            if (files.length > 0) {\n                // è·å–é€‰æ‹©çš„ç›®å½•è·¯å¾„\n                const firstFile = files[0];\n                let dirPath = firstFile.webkitRelativePath;\n                \n                // æå–ç›®å½•è·¯å¾„ï¼ˆç§»é™¤æ–‡ä»¶åéƒ¨åˆ†ï¼‰\n                const pathParts = dirPath.split('/');\n                if (pathParts.length > 1) {\n                    pathParts.pop(); // ç§»é™¤æ–‡ä»¶å\n                    dirPath = pathParts.join('\\\\'); // ä½¿ç”¨Windowsè·¯å¾„åˆ†éš”ç¬¦\n                }\n                \n                // å°è¯•è·å–å®Œæ•´è·¯å¾„ï¼ˆå¦‚æœæµè§ˆå™¨æ”¯æŒï¼‰\n                if (firstFile.path) {\n                    const fullPath = firstFile.path;\n                    const lastSlash = fullPath.lastIndexOf('\\\\');\n                    if (lastSlash !== -1) {\n                        dirPath = fullPath.substring(0, lastSlash);\n                    }\n                }\n                \n                const inputField = document.getElementById('download-dir-input');\n                inputField.value = dirPath;\n                inputField.style.backgroundColor = '#2a4a2a'; // ç»¿è‰²æç¤ºå·²é€‰æ‹©\n                \n                // é‡ç½®é¢„è®¾é€‰æ‹©å™¨\n                document.getElementById('preset-dir-select').value = '';\n                \n                // 2ç§’åæ¢å¤åŸè‰²\n                setTimeout(() => {\n                    inputField.style.backgroundColor = '#333';\n                }, 2000);\n                \n                console.log('é€‰æ‹©çš„ç›®å½•:', dirPath);\n            }\n        };\n        \n        document.getElementById('save-settings').onclick = () => {\n            const newDir = document.getElementById('download-dir-input').value.trim();\n            if (!newDir) {\n                alert('è¯·è¾“å…¥ä¸‹è½½ç›®å½•è·¯å¾„');\n                return;\n            }\n            \n            // ä½¿ç”¨downloadManagerçš„æ–¹æ³•è®¾ç½®ä¸‹è½½è·¯å¾„\n            downloadManager.setDownloadPath(newDir);\n            \n            // åŒæ—¶æ›´æ–°configä»¥ä¿æŒå…¼å®¹æ€§\n            config.downloadDir = newDir;\n            localStorage.setItem('hanime_download_dir', config.downloadDir);\n            \n            // é‡ç½®é€‰æ‹©å™¨\n            document.getElementById('preset-dir-select').value = '';\n            \n            alert(`è®¾ç½®å·²ä¿å­˜\\nä¸‹è½½ç›®å½•: ${config.downloadDir}`);\n        };\n        \n        document.getElementById('close-settings').onclick = () => {\n            panel.style.display = 'none';\n            // é‡ç½®é€‰æ‹©å™¨\n            document.getElementById('preset-dir-select').value = '';\n        };\n    }\n    \n    // åˆ›å»ºæ’­æ”¾åˆ—è¡¨é¢æ¿\n    function createPlaylistPanel() {\n        const panel = document.createElement('div');\n        panel.id = 'hanime-playlist-panel';\n        panel.style.cssText = `\n            position: fixed;\n            top: 20px;\n            left: 20px;\n            width: 350px;\n            max-height: 500px;\n            background: #2a2a2a;\n            border: 1px solid #444;\n            border-radius: 8px;\n            padding: 20px;\n            z-index: 10000;\n            color: white;\n            font-family: Arial, sans-serif;\n            display: none;\n            overflow-y: auto;\n        `;\n        \n        panel.innerHTML = `\n            <h3 style=\"margin-top: 0;\">æ’­æ”¾åˆ—è¡¨</h3>\n            <div id=\"playlist-content\"></div>\n            <button id=\"clear-playlist\" style=\"background: #dc3545; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; margin-top: 10px;\">æ¸…ç©ºåˆ—è¡¨</button>\n            <button id=\"close-playlist\" style=\"background: #6c757d; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; margin-left: 10px;\">å…³é—­</button>\n        `;\n        \n        document.body.appendChild(panel);\n        \n        // ç»‘å®šäº‹ä»¶\n        document.getElementById('clear-playlist').onclick = () => {\n            config.currentPlaylist = [];\n            updatePlaylistDisplay();\n            localStorage.removeItem('hanime_playlist');\n        };\n        \n        document.getElementById('close-playlist').onclick = () => {\n            panel.style.display = 'none';\n        };\n    }\n    \n    // åˆ›å»ºä¸‹è½½ç®¡ç†é¢æ¿\n    function createDownloadManagerPanel() {\n        const panel = document.createElement('div');\n        panel.id = 'download-manager-panel';\n        panel.style.cssText = `\n            position: fixed;\n            bottom: 20px;\n            right: 20px;\n            width: 400px;\n            max-height: 500px;\n            background: #2a2a2a;\n            border: 1px solid #444;\n            border-radius: 8px;\n            z-index: 10000;\n            color: white;\n            font-family: Arial, sans-serif;\n            display: none;\n            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);\n        `;\n        \n        panel.innerHTML = `\n            <div style=\"padding: 15px 20px; border-bottom: 1px solid #444; display: flex; justify-content: space-between; align-items: center;\">\n                <h3 style=\"margin: 0; font-size: 16px;\">ğŸ“¥ ä¸‹è½½ç®¡ç†å™¨</h3>\n                <div>\n                    <button id=\"toggle-download-list\" style=\"background: #007bff; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; margin-right: 8px; font-size: 12px;\">æ”¶èµ·</button>\n                    <button id=\"close-download-manager\" style=\"background: #6c757d; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-size: 12px;\">å…³é—­</button>\n                </div>\n            </div>\n            <div id=\"download-list-content\" style=\"max-height: 400px; overflow-y: auto; padding: 15px;\"></div>\n            <div style=\"padding: 10px 20px; border-top: 1px solid #444; font-size: 12px; color: #aaa; text-align: center;\">\n                <span id=\"download-summary\">æ€»è®¡: 0 ä¸ªä»»åŠ¡</span>\n            </div>\n        `;\n        \n        document.body.appendChild(panel);\n        \n        let isCollapsed = false;\n        \n        // ç»‘å®šäº‹ä»¶\n        document.getElementById('toggle-download-list').onclick = () => {\n            const content = document.getElementById('download-list-content');\n            const button = document.getElementById('toggle-download-list');\n            \n            if (isCollapsed) {\n                content.style.display = 'block';\n                button.textContent = 'æ”¶èµ·';\n                isCollapsed = false;\n            } else {\n                content.style.display = 'none';\n                button.textContent = 'å±•å¼€';\n                isCollapsed = true;\n            }\n        };\n        \n        document.getElementById('close-download-manager').onclick = () => {\n            panel.style.display = 'none';\n        };\n        \n        // æ›´æ–°ä¸‹è½½æ‘˜è¦\n        const updateSummary = () => {\n            const summary = document.getElementById('download-summary');\n            if (summary) {\n                const total = downloadManager.downloads.length;\n                const completed = downloadManager.downloads.filter(d => d.status === 'completed').length;\n                const downloading = downloadManager.downloads.filter(d => d.status === 'downloading').length;\n                summary.textContent = `æ€»è®¡: ${total} ä¸ªä»»åŠ¡ | å·²å®Œæˆ: ${completed} | ä¸‹è½½ä¸­: ${downloading}`;\n            }\n        };\n        \n        // é‡å†™ä¸‹è½½ç®¡ç†å™¨çš„æ›´æ–°æ–¹æ³•ä»¥åŒ…å«æ‘˜è¦æ›´æ–°\n        const originalUpdate = downloadManager.updateDownloadList;\n        downloadManager.updateDownloadList = function() {\n            originalUpdate.call(this);\n            updateSummary();\n        };\n    }\n    \n    // æ›´æ–°æ’­æ”¾åˆ—è¡¨æ˜¾ç¤º\n    function updatePlaylistDisplay() {\n        const content = document.getElementById('playlist-content');\n        if (!content) return;\n        \n        if (config.currentPlaylist.length === 0) {\n            content.innerHTML = '<p>æ’­æ”¾åˆ—è¡¨ä¸ºç©º</p>';\n            return;\n        }\n        \n        content.innerHTML = config.currentPlaylist.map((item, index) => `\n            <div style=\"padding: 8px; border-bottom: 1px solid #444; ${index === config.currentIndex ? 'background: #007bff;' : ''}\">\n                <div style=\"font-weight: bold;\">${item.title}</div>\n                <div style=\"font-size: 12px; color: #ccc;\">${item.url}</div>\n                <button onclick=\"playFromPlaylist(${index})\" style=\"background: #28a745; color: white; border: none; padding: 4px 8px; border-radius: 3px; cursor: pointer; margin-top: 5px;\">æ’­æ”¾</button>\n                <button onclick=\"removeFromPlaylist(${index})\" style=\"background: #dc3545; color: white; border: none; padding: 4px 8px; border-radius: 3px; cursor: pointer; margin-left: 5px;\">åˆ é™¤</button>\n            </div>\n        `).join('');\n    }\n    \n    // æ·»åŠ åˆ°æ’­æ”¾åˆ—è¡¨\n    function addToPlaylist(title, url) {\n        const item = { title, url };\n        config.currentPlaylist.push(item);\n        localStorage.setItem('hanime_playlist', JSON.stringify(config.currentPlaylist));\n        updatePlaylistDisplay();\n        showNotification('å·²æ·»åŠ åˆ°æ’­æ”¾åˆ—è¡¨');\n    }\n    \n    // ä»æ’­æ”¾åˆ—è¡¨æ’­æ”¾\n    window.playFromPlaylist = function(index) {\n        config.currentIndex = index;\n        config.isInPlaylist = true;\n        window.location.href = config.currentPlaylist[index].url;\n    };\n    \n    // ä»æ’­æ”¾åˆ—è¡¨åˆ é™¤\n    window.removeFromPlaylist = function(index) {\n        config.currentPlaylist.splice(index, 1);\n        if (config.currentIndex >= index && config.currentIndex > 0) {\n            config.currentIndex--;\n        }\n        localStorage.setItem('hanime_playlist', JSON.stringify(config.currentPlaylist));\n        updatePlaylistDisplay();\n    };\n    \n    // æ˜¾ç¤ºé€šçŸ¥\n    function showNotification(message) {\n        const notification = document.createElement('div');\n        notification.style.cssText = `\n            position: fixed;\n            top: 50px;\n            right: 20px;\n            background: #28a745;\n            color: white;\n            padding: 10px 20px;\n            border-radius: 4px;\n            z-index: 10001;\n            font-family: Arial, sans-serif;\n        `;\n        notification.textContent = message;\n        document.body.appendChild(notification);\n        \n        setTimeout(() => {\n            document.body.removeChild(notification);\n        }, 3000);\n    }\n    \n    // ä¸‹è½½ç®¡ç†å™¨\n    const downloadManager = {\n        downloads: [],\n        nextId: 1,\n        downloadPath: '', // ç”¨æˆ·è®¾ç½®çš„ä¸‹è½½è·¯å¾„\n        \n        // åˆå§‹åŒ–è®¾ç½®\n        init() {\n            // ä»localStorageåŠ è½½è®¾ç½®\n            this.downloadPath = localStorage.getItem('hanime_download_path') || '';\n            \n            // ç¦ç”¨æµè§ˆå™¨é»˜è®¤ä¸‹è½½è¡Œä¸º\n            this.disableBrowserDownload();\n        },\n        \n        // ç¦ç”¨æµè§ˆå™¨é»˜è®¤ä¸‹è½½\n        disableBrowserDownload() {\n            // æ‹¦æˆªæ‰€æœ‰ä¸‹è½½é“¾æ¥çš„ç‚¹å‡»äº‹ä»¶\n            document.addEventListener('click', (e) => {\n                const target = e.target.closest('a[download], a[href$=\".mp4\"], a[href$=\".mkv\"], a[href$=\".avi\"]');\n                if (target && target.href && target.href.includes('hanime')) {\n                    e.preventDefault();\n                    e.stopPropagation();\n                    console.log('å·²æ‹¦æˆªæµè§ˆå™¨é»˜è®¤ä¸‹è½½:', target.href);\n                    return false;\n                }\n            }, true);\n            \n            // æ‹¦æˆªå³é”®å¦å­˜ä¸º\n            document.addEventListener('contextmenu', (e) => {\n                const target = e.target;\n                if (target.tagName === 'VIDEO' || target.closest('video')) {\n                    // å¯ä»¥é€‰æ‹©æ˜¯å¦é˜»æ­¢è§†é¢‘çš„å³é”®èœå•\n                    // e.preventDefault();\n                }\n            });\n        },\n        \n        // è®¾ç½®ä¸‹è½½è·¯å¾„\n        setDownloadPath(path) {\n            this.downloadPath = path;\n            localStorage.setItem('hanime_download_path', path);\n            showNotification(`ä¸‹è½½è·¯å¾„å·²è®¾ç½®: ${path}`);\n        },\n        \n        async addDownload(url, filename, quality) {\n            const download = {\n                id: this.nextId++,\n                url,\n                filename,\n                quality,\n                progress: 0,\n                speed: 0,\n                status: 'validating', // validating, downloading, completed, error, paused\n                startTime: Date.now()\n            };\n            this.downloads.push(download);\n            \n            // å¦‚æœéœ€è¦éªŒè¯URLï¼Œå…ˆè¿›è¡ŒéªŒè¯\n            if (quality !== 'current') {\n                try {\n                    const response = await fetch(url, { method: 'HEAD' });\n                    if (!response.ok) {\n                        throw new Error(`URLæ— æ•ˆ: ${response.status} ${response.statusText}`);\n                    }\n                    download.status = 'downloading';\n                } catch (error) {\n                    download.status = 'error';\n                    download.error = `URLéªŒè¯å¤±è´¥: ${error.message}`;\n                    this.updateDownloadList();\n                    showNotification(`ä¸‹è½½å¤±è´¥: ${download.filename} - ${error.message}`, 'error');\n                    return;\n                }\n            } else {\n                download.status = 'downloading';\n            }\n            this.updateDownloadList();\n            this.startDownload(download);\n            return download.id;\n        },\n        \n        async startDownload(download) {\n            try {\n                // ä½¿ç”¨fetch APIè¿›è¡ŒçœŸå®ä¸‹è½½\n                const response = await fetch(download.url);\n                \n                if (!response.ok) {\n                    throw new Error(`ä¸‹è½½å¤±è´¥: ${response.status} ${response.statusText}`);\n                }\n                \n                const contentLength = response.headers.get('content-length');\n                const total = parseInt(contentLength, 10);\n                let loaded = download.loaded || 0;\n                \n                // åˆ›å»ºå¯è¯»æµæ¥è·Ÿè¸ªä¸‹è½½è¿›åº¦\n                const reader = response.body.getReader();\n                const chunks = download.chunks || [];\n                \n                download.status = 'downloading';\n                download.reader = reader; // ä¿å­˜readerå¼•ç”¨ç”¨äºæš‚åœ\n                const startTime = Date.now();\n                \n                try {\n                    while (true) {\n                        // æ£€æŸ¥æ˜¯å¦è¢«æš‚åœ\n                        if (download.status === 'paused') {\n                            download.loaded = loaded;\n                            download.chunks = chunks;\n                            return;\n                        }\n                        \n                        const { done, value } = await reader.read();\n                        \n                        if (done) break;\n                        \n                        chunks.push(value);\n                        loaded += value.length;\n                        \n                        // è®¡ç®—çœŸå®è¿›åº¦å’Œé€Ÿåº¦\n                        if (total > 0) {\n                            download.progress = (loaded / total) * 100;\n                        }\n                        \n                        const elapsed = (Date.now() - startTime) / 1000;\n                        download.speed = elapsed > 0 ? (loaded / 1024 / 1024) / elapsed : 0;\n                        \n                        this.updateDownloadList();\n                        \n                        // æ·»åŠ å°å»¶è¿Ÿä»¥å…è®¸UIæ›´æ–°å’Œæš‚åœæ£€æŸ¥\n                        await new Promise(resolve => setTimeout(resolve, 10));\n                    }\n                } catch (readerError) {\n                    if (download.status === 'paused') {\n                        return; // æ­£å¸¸æš‚åœï¼Œä¸æ˜¯é”™è¯¯\n                    }\n                    throw readerError;\n                }\n                \n                // åˆå¹¶æ‰€æœ‰æ•°æ®å—\n                const blob = new Blob(chunks);\n                \n                // å°è¯•ä½¿ç”¨Chromeä¸‹è½½APIï¼ˆå¦‚æœå¯ç”¨ï¼‰\n                if (typeof chrome !== 'undefined' && chrome.downloads) {\n                    try {\n                        const url = URL.createObjectURL(blob);\n                        const downloadOptions = {\n                            url: url,\n                            filename: download.filename,\n                            saveAs: false\n                        };\n                        \n                        // å¦‚æœè®¾ç½®äº†ä¸‹è½½è·¯å¾„ï¼Œæ·»åŠ åˆ°æ–‡ä»¶åä¸­\n                        if (this.downloadPath) {\n                            downloadOptions.filename = this.downloadPath.replace(/[\\\\/]+$/, '') + '\\\\' + download.filename;\n                        }\n                        \n                        chrome.downloads.download(downloadOptions, (downloadId) => {\n                            if (chrome.runtime.lastError) {\n                                console.log('Chrome APIä¸‹è½½å¤±è´¥ï¼Œä½¿ç”¨å¤‡ç”¨æ–¹æ³•:', chrome.runtime.lastError.message);\n                                this.fallbackDownload(blob, download.filename);\n                            } else {\n                                console.log('Chrome APIä¸‹è½½æˆåŠŸï¼ŒID:', downloadId, 'è·¯å¾„:', downloadOptions.filename);\n                            }\n                            setTimeout(() => URL.revokeObjectURL(url), 1000);\n                        });\n                    } catch (error) {\n                        console.log('Chrome APIä¸å¯ç”¨ï¼Œä½¿ç”¨å¤‡ç”¨æ–¹æ³•:', error.message);\n                        this.fallbackDownload(blob, download.filename);\n                    }\n                } else {\n                    // å¤‡ç”¨ä¸‹è½½æ–¹æ³•\n                    this.fallbackDownload(blob, download.filename);\n                }\n                \n                download.progress = 100;\n                download.status = 'completed';\n                delete download.reader;\n                delete download.loaded;\n                delete download.chunks;\n                this.updateDownloadList();\n                \n                showNotification(`ä¸‹è½½å®Œæˆ: ${download.filename}`);\n                \n            } catch (error) {\n                console.error('ä¸‹è½½é”™è¯¯:', error);\n                download.status = 'error';\n                download.error = error.message;\n                delete download.reader;\n                this.updateDownloadList();\n                showNotification(`ä¸‹è½½å¤±è´¥: ${error.message}`, 'error');\n            }\n        },\n        \n        fallbackDownload(blob, filename) {\n            // å¤‡ç”¨ä¸‹è½½æ–¹æ³•ï¼šåˆ›å»ºä¸‹è½½é“¾æ¥\n            const url = URL.createObjectURL(blob);\n            const link = document.createElement('a');\n            link.href = url;\n            link.download = filename;\n            link.style.display = 'none';\n            document.body.appendChild(link);\n            link.click();\n            document.body.removeChild(link);\n            \n            // æ¸…ç†URLå¯¹è±¡\n            setTimeout(() => URL.revokeObjectURL(url), 1000);\n        },\n        \n        // æš‚åœä¸‹è½½\n        pauseDownload(id) {\n            const download = this.downloads.find(d => d.id === id);\n            if (download && download.status === 'downloading') {\n                download.status = 'paused';\n                // å¦‚æœæœ‰readerï¼Œå°è¯•å–æ¶ˆå®ƒ\n                if (download.reader) {\n                    try {\n                        download.reader.cancel();\n                    } catch (e) {\n                        console.log('Reader cancel failed:', e);\n                    }\n                }\n                this.updateDownloadList();\n                showNotification(`ä¸‹è½½å·²æš‚åœ: ${download.filename}`);\n            }\n        },\n        \n        // æ¢å¤ä¸‹è½½\n        resumeDownload(id) {\n            const download = this.downloads.find(d => d.id === id);\n            if (download && download.status === 'paused') {\n                showNotification(`æ¢å¤ä¸‹è½½: ${download.filename}`);\n                this.startDownload(download);\n            }\n        },\n        \n        removeDownload(id) {\n            this.downloads = this.downloads.filter(d => d.id !== id);\n            this.updateDownloadList();\n        },\n        \n        updateDownloadList() {\n            const container = document.getElementById('download-list-content');\n            if (!container) return;\n            \n            container.innerHTML = '';\n            \n            if (this.downloads.length === 0) {\n                container.innerHTML = '<div style=\"text-align: center; color: #888; padding: 20px;\">æš‚æ— ä¸‹è½½ä»»åŠ¡</div>';\n                return;\n            }\n            \n            this.downloads.forEach(download => {\n                const item = document.createElement('div');\n                item.style.cssText = `\n                    background: #333;\n                    margin-bottom: 10px;\n                    padding: 15px;\n                    border-radius: 6px;\n                    border-left: 4px solid ${download.status === 'completed' ? '#28a745' : download.status === 'error' ? '#dc3545' : '#007bff'};\n                `;\n                \n                const statusText = {\n                    'validating': 'éªŒè¯ä¸­',\n                    'downloading': 'ä¸‹è½½ä¸­',\n                    'completed': 'å·²å®Œæˆ',\n                    'error': 'ä¸‹è½½å¤±è´¥',\n                    'paused': 'å·²æš‚åœ'\n                }[download.status];\n                \n                item.innerHTML = `\n                    <div style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;\">\n                        <div style=\"font-weight: bold; color: white; flex: 1; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;\">${download.filename}</div>\n                        <div>\n                            <button class=\"pause-btn\" data-id=\"${download.id}\" style=\"background: #ffc107; color: #000; border: none; padding: 4px 8px; border-radius: 3px; cursor: pointer; font-size: 12px; margin-right: 5px; display: ${download.status === 'downloading' ? 'inline-block' : 'none'};\">æš‚åœ</button>\n                            <button class=\"resume-btn\" data-id=\"${download.id}\" style=\"background: #28a745; color: white; border: none; padding: 4px 8px; border-radius: 3px; cursor: pointer; font-size: 12px; margin-right: 5px; display: ${download.status === 'paused' ? 'inline-block' : 'none'};\">æ¢å¤</button>\n                            <button class=\"delete-btn\" data-id=\"${download.id}\" style=\"background: #dc3545; color: white; border: none; padding: 4px 8px; border-radius: 3px; cursor: pointer; font-size: 12px;\">åˆ é™¤</button>\n                        </div>\n                    </div>\n                    <div style=\"color: #ccc; font-size: 12px; margin-bottom: 5px;\">${download.quality} | ${statusText}</div>\n                    ${download.error ? `<div style=\"color: #dc3545; font-size: 11px; margin-bottom: 5px;\">é”™è¯¯: ${download.error}</div>` : ''}\n                    <div style=\"background: #555; height: 6px; border-radius: 3px; overflow: hidden; margin-bottom: 5px;\">\n                        <div style=\"background: ${download.status === 'completed' ? '#28a745' : download.status === 'error' ? '#dc3545' : '#007bff'}; height: 100%; width: ${download.progress}%; transition: width 0.3s;\"></div>\n                    </div>\n                    <div style=\"display: flex; justify-content: space-between; font-size: 11px; color: #aaa;\">\n                        <span>${Math.round(download.progress)}%</span>\n                        <span>${download.status === 'downloading' ? download.speed.toFixed(1) + ' MB/s' : ''}</span>\n                    </div>\n                `;\n                \n                // æ·»åŠ äº‹ä»¶ç›‘å¬å™¨\n                const pauseBtn = item.querySelector('.pause-btn');\n                const resumeBtn = item.querySelector('.resume-btn');\n                const deleteBtn = item.querySelector('.delete-btn');\n                \n                if (pauseBtn) {\n                    pauseBtn.addEventListener('click', () => this.pauseDownload(download.id));\n                }\n                if (resumeBtn) {\n                    resumeBtn.addEventListener('click', () => this.resumeDownload(download.id));\n                }\n                if (deleteBtn) {\n                    deleteBtn.addEventListener('click', () => this.removeDownload(download.id));\n                }\n                \n                container.appendChild(item);\n            });\n        }\n    };\n    \n    // ç§»é™¤äº†å¤æ‚çš„è§†é¢‘è´¨é‡æŠ“å–åŠŸèƒ½ï¼Œç°åœ¨ç›´æ¥ä½¿ç”¨å½“å‰æ’­æ”¾çš„è§†é¢‘\n    \n    // è·å–è§†é¢‘æ ‡é¢˜\n    function getVideoTitle() {\n        // å°è¯•å¤šç§é€‰æ‹©å™¨æ¥è·å–è§†é¢‘æ ‡é¢˜\n        const titleSelectors = [\n            'h1.video-title',\n            '.video-title',\n            'h1[class*=\"title\"]',\n            '.title',\n            'h1',\n            'h2',\n            '[data-title]'\n        ];\n        \n        for (const selector of titleSelectors) {\n            const element = document.querySelector(selector);\n            if (element && element.textContent.trim()) {\n                let title = element.textContent.trim();\n                // æ¸…ç†æ ‡é¢˜ï¼Œç§»é™¤å¤šä½™çš„ç©ºç™½å’Œç‰¹æ®Šå­—ç¬¦\n                title = title.replace(/\\s+/g, ' ').trim();\n                // å¦‚æœæ ‡é¢˜ä¸æ˜¯é¡µé¢æ ‡é¢˜ä¸”é•¿åº¦åˆç†ï¼Œåˆ™ä½¿ç”¨å®ƒ\n                if (title !== document.title && title.length > 3 && title.length < 200) {\n                    return title;\n                }\n            }\n        }\n        \n        // å¦‚æœæ²¡æœ‰æ‰¾åˆ°åˆé€‚çš„è§†é¢‘æ ‡é¢˜ï¼Œå°è¯•ä»é¡µé¢æ ‡é¢˜ä¸­æå–\n        let pageTitle = document.title;\n        // ç§»é™¤å¸¸è§çš„ç½‘ç«™åç¼€\n        pageTitle = pageTitle.replace(/\\s*-\\s*Hanime1\\.me.*$/i, '');\n        pageTitle = pageTitle.replace(/\\s*\\|\\s*Hanime.*$/i, '');\n        pageTitle = pageTitle.trim();\n        \n        return pageTitle || 'video';\n    }\n    \n    // ç§»é™¤äº†å¤æ‚çš„è´¨é‡é€‰æ‹©å™¨ï¼Œç°åœ¨ç›´æ¥ä¸‹è½½å½“å‰æ’­æ”¾çš„è§†é¢‘\n    \n    // ä¸»ä¸‹è½½å‡½æ•°\n    async function downloadVideo() {\n        const video = document.querySelector('video');\n        if (!video) {\n            alert('æœªæ‰¾åˆ°è§†é¢‘å…ƒç´ ');\n            return;\n        }\n        \n        const videoSrc = video.src || video.currentSrc;\n        if (!videoSrc) {\n            alert('æ— æ³•è·å–è§†é¢‘é“¾æ¥');\n            return;\n        }\n        \n        // ç›´æ¥ä¸‹è½½å½“å‰æ’­æ”¾çš„è§†é¢‘\n        const videoTitle = getVideoTitle();\n        const filename = `${videoTitle}.mp4`;\n        \n        showNotification('å¼€å§‹ä¸‹è½½å½“å‰è§†é¢‘...', 'info');\n        downloadManager.addDownload(videoSrc, filename);\n        \n        // æ˜¾ç¤ºä¸‹è½½ç®¡ç†å™¨\n        const panel = document.getElementById('download-manager-panel');\n        if (panel) {\n            panel.style.display = 'block';\n        }\n    }\n    \n    // ç§»é™¤äº†è§†é¢‘é¢„è§ˆåŠŸèƒ½ï¼Œä¸“æ³¨äºç‚¹å‡»è·³è½¬\n    \n    // æ·»åŠ è§†é¢‘å°é¢ç‚¹å‡»è·³è½¬åŠŸèƒ½\nfunction addVideoThumbnailClick() {\n        // åªå¤„ç†è§†é¢‘ç›¸å…³çš„å›¾ç‰‡ï¼Œé¿å…å½±å“å…¶ä»–åŠŸèƒ½\n        const videoImages = document.querySelectorAll(\n            'img[src*=\"thumb\"], img[src*=\"cover\"], img[src*=\"preview\"], ' +\n            '.video-thumbnail img, .video-item img, .video-card img, ' +\n            '[class*=\"video\"] img, [data-video-id] img'\n        );\n        \n        videoImages.forEach(img => {\n            // æ£€æŸ¥æ˜¯å¦å·²ç»å¤„ç†è¿‡\n            if (img.dataset.clickHandlerAdded) return;\n            \n            // æŸ¥æ‰¾æœ€è¿‘çš„åŒ…å«è§†é¢‘é“¾æ¥çš„çˆ¶å…ƒç´ \n            let parentLink = img.closest('a[href*=\"/watch/\"], a[href*=\"/video/\"]');\n            \n            if (parentLink && parentLink.href) {\n                // å¦‚æœå›¾ç‰‡å·²ç»åœ¨é“¾æ¥å†…ï¼Œåªæ·»åŠ è§†è§‰æ•ˆæœï¼Œä¸å¹²æ‰°åŸæœ‰ç‚¹å‡»\n                if (!img.style.cursor) {\n                    img.style.cursor = 'pointer';\n                }\n                img.style.transition = 'all 0.2s ease';\n                \n                // æ·»åŠ è½»å¾®çš„æ‚¬åœæ•ˆæœï¼Œä¸å½±å“åŸæœ‰åŠŸèƒ½\n                img.addEventListener('mouseenter', () => {\n                    if (!img.dataset.hoverActive) {\n                        img.style.opacity = '0.9';\n                        img.dataset.hoverActive = 'true';\n                    }\n                });\n                \n                img.addEventListener('mouseleave', () => {\n                    img.style.opacity = '1';\n                    img.dataset.hoverActive = 'false';\n                });\n                \n                img.dataset.clickHandlerAdded = 'true';\n                console.log('å·²ä¸ºé“¾æ¥å†…å›¾ç‰‡æ·»åŠ æ‚¬åœæ•ˆæœ:', parentLink.href);\n            } else {\n                // åªä¸ºç¡®å®æ²¡æœ‰é“¾æ¥çš„è§†é¢‘å›¾ç‰‡æ·»åŠ ç‚¹å‡»åŠŸèƒ½\n                const videoContainer = img.closest('[class*=\"video\"], [id*=\"video\"], [data-video]');\n                if (videoContainer && !videoContainer.querySelector('a[href*=\"/watch/\"], a[href*=\"/video/\"]')) {\n                    const videoId = extractVideoIdFromThumbnail(img);\n                    if (videoId) {\n                        img.style.cursor = 'pointer';\n                        img.style.transition = 'all 0.2s ease';\n                        \n                        // ä½¿ç”¨æ›´å®‰å…¨çš„äº‹ä»¶å¤„ç†ï¼Œé¿å…å†²çª\n                        const clickHandler = (e) => {\n                            // ç¡®ä¿ä¸æ˜¯åœ¨å…¶ä»–äº¤äº’å…ƒç´ ä¸Šç‚¹å‡»\n                            if (e.target === img && !e.defaultPrevented) {\n                                e.preventDefault();\n                                e.stopPropagation();\n                                const videoUrl = `${window.location.origin}/watch/${videoId}`;\n                                console.log('è·³è½¬åˆ°è§†é¢‘é¡µé¢:', videoUrl);\n                                window.location.href = videoUrl;\n                            }\n                        };\n                        \n                        img.addEventListener('click', clickHandler, { passive: false });\n                        \n                        // æ·»åŠ æ‚¬åœæ•ˆæœ\n                        img.addEventListener('mouseenter', () => {\n                            if (!img.dataset.hoverActive) {\n                                img.style.opacity = '0.9';\n                                img.dataset.hoverActive = 'true';\n                            }\n                        });\n                        \n                        img.addEventListener('mouseleave', () => {\n                            img.style.opacity = '1';\n                            img.dataset.hoverActive = 'false';\n                        });\n                        \n                        img.dataset.clickHandlerAdded = 'true';\n                        console.log('å·²ä¸ºæ— é“¾æ¥å›¾ç‰‡æ·»åŠ ç‚¹å‡»åŠŸèƒ½:', videoUrl);\n                    }\n                }\n            }\n        });\n        \n        // è°¨æ…å¤„ç†è§†é¢‘å¡ç‰‡å®¹å™¨çš„ç‚¹å‡»ï¼Œé¿å…å¹²æ‰°åŸæœ‰åŠŸèƒ½\n        const videoCardSelectors = [\n            '.video-item:not([data-click-handled])',\n            '.video-card:not([data-click-handled])',\n            '.video-thumbnail:not([data-click-handled])'\n        ];\n        \n        videoCardSelectors.forEach(selector => {\n            const cards = document.querySelectorAll(selector);\n            cards.forEach(card => {\n                if (card.dataset.clickHandlerAdded) return;\n                \n                // æŸ¥æ‰¾å¡ç‰‡å†…çš„é“¾æ¥\n                const link = card.querySelector('a[href*=\"/watch/\"], a[href*=\"/video/\"]');\n                if (link && link.href) {\n                    // æ£€æŸ¥æ˜¯å¦å·²æœ‰ç‚¹å‡»å¤„ç†å™¨\n                    const hasExistingHandlers = card.onclick || \n                        card.getAttribute('onclick') || \n                        card.dataset.clickHandled;\n                    \n                    if (!hasExistingHandlers) {\n                        // åªåœ¨å®‰å…¨çš„æƒ…å†µä¸‹æ·»åŠ ç‚¹å‡»å¤„ç†\n                        const clickHandler = (e) => {\n                            // æ›´ä¸¥æ ¼çš„æ£€æŸ¥ï¼Œé¿å…å¹²æ‰°å…¶ä»–äº¤äº’\n                            if (e.target === card || \n                                (!e.target.closest('a, button, input, select, textarea') && \n                                 !e.target.onclick && \n                                 !e.target.getAttribute('onclick'))) {\n                                e.preventDefault();\n                                console.log('å¡ç‰‡ç‚¹å‡»è·³è½¬:', link.href);\n                                window.location.href = link.href;\n                            }\n                        };\n                        \n                        card.addEventListener('click', clickHandler, { passive: false });\n                        card.style.cursor = 'pointer';\n                    }\n                    \n                    card.dataset.clickHandlerAdded = 'true';\n                }\n            });\n        });\n    }\n    \n    // ä»ç¼©ç•¥å›¾ä¸­æå–è§†é¢‘ID\n    function extractVideoIdFromThumbnail(thumbnail) {\n        // å°è¯•ä»srcå±æ€§ä¸­æå–\n        const src = thumbnail.src || thumbnail.dataset.src || thumbnail.dataset.original;\n        if (src) {\n            // åŒ¹é…å¸¸è§çš„è§†é¢‘IDæ¨¡å¼\n            const patterns = [\n                /\\/([a-zA-Z0-9_-]+)\\.(jpg|jpeg|png|webp)/,\n                /thumb\\/([a-zA-Z0-9_-]+)/,\n                /cover\\/([a-zA-Z0-9_-]+)/,\n                /preview\\/([a-zA-Z0-9_-]+)/,\n                /([a-zA-Z0-9_-]{8,})/\n            ];\n            \n            for (const pattern of patterns) {\n                const match = src.match(pattern);\n                if (match && match[1]) {\n                    return match[1];\n                }\n            }\n        }\n        \n        // å°è¯•ä»dataå±æ€§ä¸­æå–\n        const dataId = thumbnail.dataset.videoId || thumbnail.dataset.id;\n        if (dataId) {\n            return dataId;\n        }\n        \n        // å°è¯•ä»çˆ¶å…ƒç´ çš„å±æ€§ä¸­æå–\n        const parent = thumbnail.closest('[data-video-id], [data-id]');\n        if (parent) {\n            return parent.dataset.videoId || parent.dataset.id;\n        }\n        \n        return null;\n    }\n    \n    // å±è”½å¹¿å‘Š\n    function blockAds() {\n        const adSelectors = [\n            '.ad', '.ads', '.advertisement', '.banner',\n            '[class*=\"ad-\"]', '[id*=\"ad-\"]',\n            'iframe[src*=\"ads\"]', 'iframe[src*=\"doubleclick\"]',\n            '.popup', '.overlay', '.modal',\n            \n            // ç”¨æˆ·æŒ‡å®šçš„å¹¿å‘Šé€‰æ‹©å™¨\n            '#content-div > div.row.no-gutter.video-show-width > div.col-md-3.single-show-list > div:nth-child(1)',\n            \n            // ç›¸ä¼¼ç‰¹å¾çš„å¹¿å‘Šé€‰æ‹©å™¨\n            '#content-div .col-md-3.single-show-list > div:first-child',\n            '.col-md-3.single-show-list > div:nth-child(1)',\n            '.single-show-list > div:first-child',\n            '[class*=\"single-show-list\"] > div:first-child',\n            \n            // åŸºäºå®é™…ç½‘ç«™ç»“æ„çš„å¹¿å‘Šé€‰æ‹©å™¨\n            // Exoclick å¹¿å‘Š\n            'div[id*=\"exoclick\"]',\n            'div[class*=\"exoclick\"]',\n            'script[src*=\"exoclick\"]',\n            \n            // JuicyAds å¹¿å‘Šï¼ˆåŸºäºå®é™…ç½‘ç«™åˆ†æï¼‰\n            'div[id*=\"juicyads\"]',\n            'div[class*=\"juicyads\"]',\n            'script[src*=\"juicyads\"]',\n            'a[href*=\"juicyads.com\"]',\n            'a[href*=\"ck.juicyads.com\"]',\n            'a[href*=\"ux13.juicyads.com\"]',\n            'img[src*=\"ads.juicyads.me\"]',\n            'img[src*=\"juicyads\"]',\n            'table:has(a[href*=\"juicyads\"])',\n            'td:has(a[href*=\"juicyads\"])',\n            'tr:has(a[href*=\"juicyads\"])',\n            \n            // Google Ads\n            'div[id*=\"google_ads\"]',\n            'div[class*=\"google-ads\"]',\n            'script[src*=\"googlesyndication\"]',\n            'iframe[src*=\"googlesyndication\"]',\n            \n            // å¼¹çª—å¹¿å‘Šç›¸å…³\n            '.stripchat-popunder',\n            '.home-card-popunder',\n            'a[class*=\"popunder\"]',\n            'div[class*=\"popunder\"]',\n            \n            // é«˜z-indexå…ƒç´ ï¼ˆé€šå¸¸æ˜¯å¹¿å‘Šï¼‰\n            'div[style*=\"z-index: 9999\"]',\n            'div[style*=\"z-index: 99999\"]',\n            'div[style*=\"z-index: 999999\"]',\n            'div[style*=\"z-index: 10000\"]',\n            \n            // å›ºå®šå®šä½çš„å¯ç–‘å…ƒç´ \n            'div[style*=\"position: fixed\"][style*=\"width: 100%\"][style*=\"height: 100%\"]',\n            'div[style*=\"position: fixed\"][style*=\"top: 0\"][style*=\"left: 0\"]',\n            'div[style*=\"position: fixed\"][style*=\"bottom: 0\"]',\n            \n            // å¹¿å‘Šè„šæœ¬å’Œiframe\n            'iframe[src*=\"exoclick\"]',\n            'iframe[src*=\"juicyads\"]',\n            'script[src*=\"ads\"]',\n            'script[src*=\"advertising\"]',\n            'script[data-cfasync=\"false\"]',\n            \n            // å¤–éƒ¨å¹¿å‘Šé“¾æ¥ï¼ˆåŸºäºå®é™…ç½‘ç«™åˆ†æï¼‰\n            'a[href*=\"l.labsda.com\"]',\n            'a[href*=\"l.erodatalabs.com\"]',\n            'a[href*=\"l.sqzkm.com\"]',\n            'img[src*=\"erolabs\"]',\n            \n            // åŒ…å«å¹¿å‘Šæ–‡æœ¬çš„å…ƒç´ \n            '*:contains(\"é»é»å»£å‘Šï¼Œè´ŠåŠ©æˆ‘å€‘\")',\n            '*:contains(\"Ads by JuicyAds\")',\n            '*:contains(\"Advertisement\")',\n            \n            // è¡¨æ ¼å½¢å¼çš„å¹¿å‘Š\n            'table[style*=\"width\"][style*=\"height\"]:has(a[href*=\"ads\"])',\n            'table:has(img[src*=\"ads\"])',\n            'table:has(a[href*=\"juicyads\"])',\n            'table:has(a[href*=\"exoclick\"])'\n        ];\n        \n        let blockedCount = 0;\n        \n        // æ³¨å…¥CSSæ ·å¼æ¥éšè—å¹¿å‘Š\n        const style = document.createElement('style');\n        style.textContent = `\n            /* éšè—JuicyAdså¹¿å‘Š */\n            a[href*=\"juicyads.com\"],\n            a[href*=\"ck.juicyads.com\"],\n            a[href*=\"ux13.juicyads.com\"],\n            img[src*=\"ads.juicyads.me\"],\n            table:has(a[href*=\"juicyads\"]),\n            /* éšè—å¤–éƒ¨å¹¿å‘Šé“¾æ¥ */\n            a[href*=\"l.labsda.com\"],\n            a[href*=\"l.erodatalabs.com\"],\n            a[href*=\"l.sqzkm.com\"],\n            /* éšè—å¹¿å‘Šè„šæœ¬ */\n            script[src*=\"juicyads\"],\n            script[src*=\"exoclick\"],\n            iframe[src*=\"juicyads\"],\n            iframe[src*=\"exoclick\"] {\n                display: none !important;\n                visibility: hidden !important;\n                opacity: 0 !important;\n                height: 0 !important;\n                width: 0 !important;\n                position: absolute !important;\n                left: -9999px !important;\n                top: -9999px !important;\n                z-index: -1 !important;\n            }\n        `;\n        document.head.appendChild(style);\n        \n        // æ‹¦æˆªå¹¿å‘Šå…ƒç´ \n        adSelectors.forEach(selector => {\n            try {\n                const elements = document.querySelectorAll(selector);\n                elements.forEach(el => {\n                    if (el && !el.hasAttribute('data-blocked')) {\n                        // å¤šé‡éšè—ç¡®ä¿å¹¿å‘Šè¢«å®Œå…¨å±è”½\n                        el.style.setProperty('display', 'none', 'important');\n                        el.style.setProperty('visibility', 'hidden', 'important');\n                        el.style.setProperty('opacity', '0', 'important');\n                        el.style.setProperty('height', '0', 'important');\n                        el.style.setProperty('width', '0', 'important');\n                        el.style.setProperty('overflow', 'hidden', 'important');\n                        el.style.setProperty('position', 'absolute', 'important');\n                        el.style.setProperty('left', '-9999px', 'important');\n                        el.style.setProperty('top', '-9999px', 'important');\n                        el.style.setProperty('z-index', '-1', 'important');\n                        \n                        // ç§»é™¤äº‹ä»¶ç›‘å¬å™¨\n                        if (el.onclick) el.onclick = null;\n                        if (el.onmousedown) el.onmousedown = null;\n                        if (el.onmouseup) el.onmouseup = null;\n                        if (el.addEventListener) {\n                            el.removeEventListener('click', function() {});\n                            el.removeEventListener('mousedown', function() {});\n                        }\n                        \n                        // ç§»é™¤å…ƒç´ \n                        try {\n                            if (el.parentNode) {\n                                el.parentNode.removeChild(el);\n                            }\n                        } catch (e) {\n                            // å¦‚æœæ— æ³•ç§»é™¤ï¼Œè‡³å°‘éšè—\n                            el.style.setProperty('display', 'none', 'important');\n                        }\n                        \n                        // æ ‡è®°ä¸ºå·²æ‹¦æˆª\n                        el.setAttribute('data-blocked', 'true');\n                        \n                        blockedCount++;\n                        console.log('å·²æ‹¦æˆªå¹¿å‘Šå…ƒç´ :', selector, el);\n                    }\n                });\n            } catch (e) {\n                console.log('é€‰æ‹©å™¨é”™è¯¯:', selector, e.message);\n            }\n        });\n        \n        // æ‹¦æˆªå¼¹çª—äº‹ä»¶\n        const originalOpen = window.open;\n        window.open = function(url, name, specs) {\n            console.log('æ‹¦æˆªå¼¹çª—:', url);\n            return null;\n        };\n        \n        // æ‹¦æˆªå¹¿å‘Šç›¸å…³çš„ç‚¹å‡»äº‹ä»¶\n        document.addEventListener('click', function(e) {\n            const target = e.target;\n            if (target && (\n                target.classList.contains('stripchat-popunder') ||\n                target.classList.contains('home-card-popunder') ||\n                target.className.includes('popunder') ||\n                target.href && (target.href.includes('exoclick') || target.href.includes('juicyads'))\n            )) {\n                e.preventDefault();\n                e.stopPropagation();\n                console.log('æ‹¦æˆªå¹¿å‘Šç‚¹å‡»:', target);\n                return false;\n            }\n        }, true);\n        \n        if (blockedCount > 0) {\n            console.log(`æœ¬æ¬¡æ‹¦æˆªäº† ${blockedCount} ä¸ªå¹¿å‘Šå…ƒç´ `);\n        }\n        \n        // ä½¿ç”¨MutationObserverç›‘æ§DOMå˜åŒ–\n        if (!window.adBlockObserver) {\n            window.adBlockObserver = new MutationObserver(function(mutations) {\n                let hasNewAds = false;\n                mutations.forEach(function(mutation) {\n                    if (mutation.type === 'childList') {\n                        mutation.addedNodes.forEach(function(node) {\n                            if (node.nodeType === 1) { // Element node\n                                // æ£€æŸ¥æ–°æ·»åŠ çš„èŠ‚ç‚¹æ˜¯å¦æ˜¯å¹¿å‘Š\n                                adSelectors.forEach(selector => {\n                                    try {\n                                        if (node.matches && node.matches(selector)) {\n                                            hasNewAds = true;\n                                        }\n                                        // æ£€æŸ¥å­å…ƒç´ \n                                        const childAds = node.querySelectorAll && node.querySelectorAll(selector);\n                                        if (childAds && childAds.length > 0) {\n                                            hasNewAds = true;\n                                        }\n                                    } catch (e) {\n                                        // å¿½ç•¥é€‰æ‹©å™¨é”™è¯¯\n                                    }\n                                });\n                            }\n                        });\n                    }\n                });\n                \n                if (hasNewAds) {\n                    console.log('æ£€æµ‹åˆ°æ–°çš„å¹¿å‘Šå…ƒç´ ï¼Œé‡æ–°è¿è¡Œæ‹¦æˆª');\n                    setTimeout(blockAds, 100);\n                }\n            });\n            \n            // å¼€å§‹è§‚å¯Ÿ\n            window.adBlockObserver.observe(document.body, {\n                childList: true,\n                subtree: true\n            });\n        }\n        \n        // è®¾ç½®å®šæ—¶å™¨æŒç»­ç›‘æ§æ–°çš„å¹¿å‘Š\n        setTimeout(() => {\n            blockAds();\n        }, 3000);\n        \n        // é¡µé¢åŠ è½½å®Œæˆåå†æ¬¡æ£€æŸ¥\n        if (document.readyState === 'loading') {\n            document.addEventListener('DOMContentLoaded', () => {\n                setTimeout(blockAds, 1000);\n            });\n        }\n        \n        // çª—å£åŠ è½½å®Œæˆåå†æ¬¡æ£€æŸ¥\n        window.addEventListener('load', () => {\n            setTimeout(blockAds, 2000);\n        });\n    }\n    \n    // é”®ç›˜å¿«æ·é”®å¤„ç†\n    function handleKeyboardShortcuts(e) {\n        // Alt+å·¦ç®­å¤´ åé€€\n        if (e.altKey && e.key === 'ArrowLeft') {\n            e.preventDefault();\n            window.history.back();\n        }\n        \n        // Alt+å³ç®­å¤´ å‰è¿›\n        if (e.altKey && e.key === 'ArrowRight') {\n            e.preventDefault();\n            window.history.forward();\n        }\n        \n        // F5 åˆ·æ–°\n        if (e.key === 'F5') {\n            // ä¸é˜»æ­¢é»˜è®¤è¡Œä¸ºï¼Œè®©æµè§ˆå™¨æ­£å¸¸åˆ·æ–°\n            return;\n        }\n        \n        // Ctrl+D ä¸‹è½½\n        if (e.ctrlKey && e.key === 'd') {\n            e.preventDefault();\n            downloadVideo().catch(console.error);\n        }\n        \n        // Ctrl+S è®¾ç½®\n        if (e.ctrlKey && e.key === 's') {\n            e.preventDefault();\n            const panel = document.getElementById('hanime-settings-panel');\n            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';\n        }\n        \n        // Ctrl+P æ’­æ”¾åˆ—è¡¨\n        if (e.ctrlKey && e.key === 'p') {\n            e.preventDefault();\n            const panel = document.getElementById('hanime-playlist-panel');\n            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';\n        }\n        \n        // Ctrl+M ä¸‹è½½ç®¡ç†å™¨\n        if (e.ctrlKey && e.key === 'm') {\n            e.preventDefault();\n            const panel = document.getElementById('download-manager-panel');\n            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';\n        }\n        \n        // Ctrl+H ä¸»é¡µ\n        if (e.ctrlKey && e.key === 'h') {\n            e.preventDefault();\n            window.location.href = '/';\n        }\n        \n        // Home é¡µé¢é¡¶éƒ¨\n        if (e.key === 'Home') {\n            e.preventDefault();\n            window.scrollTo({ top: 0, behavior: 'smooth' });\n        }\n        \n        // End é¡µé¢åº•éƒ¨\n        if (e.key === 'End') {\n            e.preventDefault();\n            window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });\n        }\n        \n        // ç©ºæ ¼é”® æ’­æ”¾/æš‚åœ\n        if (e.key === ' ') {\n            const video = document.querySelector('video');\n            if (video) {\n                e.preventDefault();\n                if (video.paused) {\n                    video.play();\n                } else {\n                    video.pause();\n                }\n            }\n        }\n    }\n    \n    // é•¿æŒ‰å³ç®­å¤´å€é€Ÿæ’­æ”¾\n    let speedBoostTimeout;\n    function handleSpeedBoost() {\n        document.addEventListener('keydown', (e) => {\n            if (e.key === 'ArrowRight' && !speedBoostTimeout) {\n                speedBoostTimeout = setTimeout(() => {\n                    const video = document.querySelector('video');\n                    if (video) {\n                        video.playbackRate = 2;\n                        showNotification('å€é€Ÿæ’­æ”¾ä¸­');\n                    }\n                }, 500); // é•¿æŒ‰500msåè§¦å‘\n            }\n        });\n        \n        document.addEventListener('keyup', (e) => {\n            if (e.key === 'ArrowRight') {\n                if (speedBoostTimeout) {\n                    clearTimeout(speedBoostTimeout);\n                    speedBoostTimeout = null;\n                }\n                const video = document.querySelector('video');\n                if (video && video.playbackRate !== 1) {\n                    video.playbackRate = 1;\n                    showNotification('æ¢å¤æ­£å¸¸æ’­æ”¾');\n                }\n            }\n        });\n    }\n    \n    // è§†é¢‘æ’­æ”¾å®Œæˆå¤„ç†\n    function handleVideoEnd() {\n        const video = document.querySelector('video');\n        if (!video) return;\n        \n        video.addEventListener('ended', () => {\n            if (config.isInPlaylist && config.currentPlaylist.length > 0) {\n                // æ’­æ”¾åˆ—è¡¨ä¸­çš„ä¸‹ä¸€ä¸ªè§†é¢‘\n                config.currentIndex = (config.currentIndex + 1) % config.currentPlaylist.length;\n                window.location.href = config.currentPlaylist[config.currentIndex].url;\n            } else {\n                // é‡å¤æ’­æ”¾å½“å‰è§†é¢‘\n                video.currentTime = 0;\n                video.play();\n                showNotification('é‡å¤æ’­æ”¾å½“å‰è§†é¢‘');\n            }\n        });\n    }\n    \n    // åˆ›å»ºæµ®åŠ¨æ§åˆ¶æŒ‰é’®\n    function createFloatingControls() {\n        const controls = document.createElement('div');\n        controls.id = 'hanime-floating-controls';\n        controls.style.cssText = `\n            position: fixed;\n            bottom: 20px;\n            left: 50%;\n            transform: translateX(-50%);\n            z-index: 9999;\n            display: flex;\n            flex-direction: row;\n            gap: 2px;\n            background: #f1f3f4;\n            border-radius: 25px;\n            padding: 8px;\n            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);\n            backdrop-filter: blur(10px);\n            border: 1px solid #dadce0;\n        `;\n        \n        const buttons = [\n            { text: 'â†', title: 'åé€€ (Alt+â†)', action: () => window.history.back() },\n            { text: 'â†’', title: 'å‰è¿› (Alt+â†’)', action: () => window.history.forward() },\n            { text: 'â†»', title: 'åˆ·æ–° (F5)', action: () => window.location.reload() },\n            { text: 'ğŸ ', title: 'ä¸»é¡µ (Ctrl+H)', action: () => window.location.href = '/' },\n            { text: 'âš™ï¸', title: 'è®¾ç½® (Ctrl+S)', action: () => {\n                const panel = document.getElementById('hanime-settings-panel');\n                panel.style.display = panel.style.display === 'none' ? 'block' : 'none';\n            }},\n            { text: 'ğŸ“‹', title: 'æ’­æ”¾åˆ—è¡¨ (Ctrl+P)', action: () => {\n                const panel = document.getElementById('hanime-playlist-panel');\n                panel.style.display = panel.style.display === 'none' ? 'block' : 'none';\n            }},\n            { text: 'ğŸ“¥', title: 'ä¸‹è½½ç®¡ç†å™¨ (Ctrl+M)', action: () => {\n                const panel = document.getElementById('download-manager-panel');\n                panel.style.display = panel.style.display === 'none' ? 'block' : 'none';\n            }},\n            { text: 'â¬‡ï¸', title: 'ä¸‹è½½è§†é¢‘ (Ctrl+D)', action: () => downloadVideo().catch(console.error) },\n            { text: 'â•', title: 'æ·»åŠ åˆ°æ’­æ”¾åˆ—è¡¨', action: () => {\n                const videoTitle = getVideoTitle();\n                addToPlaylist(videoTitle, window.location.href);\n            }}\n        ];\n        \n        buttons.forEach((btn, index) => {\n            const button = document.createElement('button');\n            button.textContent = btn.text;\n            button.title = btn.title;\n            button.style.cssText = `\n                min-width: 36px;\n                height: 36px;\n                border: none;\n                border-radius: 18px;\n                background: transparent;\n                color: #5f6368;\n                font-size: 14px;\n                cursor: pointer;\n                transition: all 0.2s ease;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                font-weight: 500;\n                padding: 0 8px;\n                position: relative;\n            `;\n            \n            // æ·»åŠ åˆ†éš”çº¿\n            if (index === 3 || index === 6) {\n                const separator = document.createElement('div');\n                separator.style.cssText = `\n                    width: 1px;\n                    height: 20px;\n                    background: #dadce0;\n                    margin: 0 4px;\n                `;\n                controls.appendChild(separator);\n            }\n            \n            button.onmouseover = () => {\n                button.style.background = '#e8eaed';\n                button.style.color = '#202124';\n            };\n            \n            button.onmouseout = () => {\n                button.style.background = 'transparent';\n                button.style.color = '#5f6368';\n            };\n            \n            button.onmousedown = () => {\n                button.style.background = '#dadce0';\n            };\n            \n            button.onmouseup = () => {\n                button.style.background = '#e8eaed';\n            };\n            \n            button.onclick = btn.action;\n            controls.appendChild(button);\n        });\n        \n        // æ·»åŠ é¡µé¢é¡¶éƒ¨å’Œåº•éƒ¨æŒ‰é’®ï¼ˆä¿æŒåœ¨å³ä¾§ï¼‰\n        const verticalControls = document.createElement('div');\n        verticalControls.id = 'hanime-vertical-controls';\n        verticalControls.style.cssText = `\n            position: fixed;\n            top: 50%;\n            right: 20px;\n            transform: translateY(-50%);\n            z-index: 9999;\n            display: flex;\n            flex-direction: column;\n            gap: 10px;\n        `;\n        \n        const verticalButtons = [\n            { text: 'â¬†ï¸', title: 'å›åˆ°é¡¶éƒ¨ (Home)', action: () => window.scrollTo({ top: 0, behavior: 'smooth' }) },\n            { text: 'â¬‡ï¸', title: 'æ»šåŠ¨åˆ°åº•éƒ¨ (End)', action: () => window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' }) }\n        ];\n        \n        verticalButtons.forEach(btn => {\n            const button = document.createElement('button');\n            button.textContent = btn.text;\n            button.title = btn.title;\n            button.style.cssText = `\n                width: 45px;\n                height: 45px;\n                border: none;\n                border-radius: 50%;\n                background: #f1f3f4;\n                color: #5f6368;\n                font-size: 16px;\n                cursor: pointer;\n                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\n                transition: all 0.2s ease;\n                border: 1px solid #dadce0;\n            `;\n            \n            button.onmouseover = () => {\n                button.style.background = '#e8eaed';\n                button.style.color = '#202124';\n                button.style.transform = 'scale(1.05)';\n            };\n            \n            button.onmouseout = () => {\n                button.style.background = '#f1f3f4';\n                button.style.color = '#5f6368';\n                button.style.transform = 'scale(1)';\n            };\n            \n            button.onclick = btn.action;\n            verticalControls.appendChild(button);\n        });\n        \n        document.body.appendChild(controls);\n        document.body.appendChild(verticalControls);\n    }\n    \n    // åˆå§‹åŒ–\n    function init() {\n        // åˆå§‹åŒ–ä¸‹è½½ç®¡ç†å™¨\n        downloadManager.init();\n        \n        // åŠ è½½ä¿å­˜çš„æ’­æ”¾åˆ—è¡¨\n        const savedPlaylist = localStorage.getItem('hanime_playlist');\n        if (savedPlaylist) {\n            config.currentPlaylist = JSON.parse(savedPlaylist);\n        }\n        \n        // æ£€æŸ¥å½“å‰é¡µé¢æ˜¯å¦åœ¨æ’­æ”¾åˆ—è¡¨ä¸­\n        const currentUrl = window.location.href;\n        const currentIndex = config.currentPlaylist.findIndex(item => item.url === currentUrl);\n        if (currentIndex !== -1) {\n            config.currentIndex = currentIndex;\n            config.isInPlaylist = true;\n        }\n        \n        // åˆ›å»ºUIç»„ä»¶\n        createSettingsPanel();\n        createPlaylistPanel();\n        createDownloadManagerPanel();\n        createFloatingControls();\n        \n        // ç»‘å®šäº‹ä»¶\n        document.addEventListener('keydown', handleKeyboardShortcuts);\n        handleSpeedBoost();\n        \n        // ç­‰å¾…é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œ\n        setTimeout(() => {\n            addVideoThumbnailClick();\n            handleVideoEnd();\n            blockAds();\n            \n            // å®šæœŸæ¸…ç†å¹¿å‘Šå’Œé‡æ–°ç»‘å®šç‚¹å‡»äº‹ä»¶ï¼ˆé™ä½é¢‘ç‡ï¼Œå‡å°‘æ€§èƒ½å½±å“ï¼‰\n            setInterval(() => {\n                blockAds();\n                // åªåœ¨æ£€æµ‹åˆ°æ–°å†…å®¹æ—¶æ‰é‡æ–°ç»‘å®š\n                const newImages = document.querySelectorAll('img:not([data-click-handler-added])');\n                if (newImages.length > 0) {\n                    addVideoThumbnailClick();\n                }\n            }, 8000); // å¢åŠ åˆ°8ç§’ï¼Œå‡å°‘æ€§èƒ½å½±å“\n        }, 2000);\n        \n        updatePlaylistDisplay();\n        \n        console.log('Hanime1.me å¢å¼ºåŠŸèƒ½å·²åŠ è½½');\n    }\n    \n    // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–\n    if (document.readyState === 'loading') {\n        document.addEventListener('DOMContentLoaded', init);\n    } else {\n        init();\n    }\n})();","isHtml":false,"htmlPath":"","htmlFiles":[],"more":{"windows":{"label":"","title":"","url":"https://hanime1.me/","userAgent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/130.0.0.0 Safari/537.36","width":1200,"height":800,"theme":null,"resizable":true,"fullscreen":false,"maximized":false,"minWidth":400,"minHeight":300,"maxWidth":1920,"maxHeight":1080,"decorations":true,"transparent":false,"titleBarStyle":"Visible","visible":true,"focus":true,"closable":true,"minimizable":true,"maximizable":true,"alwaysOnTop":false,"alwaysOnBottom":false,"center":false,"skipTaskbar":false,"tabbingIdentifier":null,"parent":null,"dragDropEnabled":true,"browserExtensionsEnabled":false,"devtools":true,"contentProtected":false,"hiddenTitle":false,"incognito":false,"proxyUrl":null,"useHttpsScheme":false,"zoomHotkeysEnabled":false,"acceptFirstMouse":false,"create":false}},"phone":{"safeArea":{"top":0,"bottom":0,"left":0,"right":0},"header":{"show":false,"title":"","backgroundColor":"","color":"","fontSize":16,"fontWeight":"bold","loading":false,"toolBar":false,"toolBarBackgroundColor":"","toolBarColor":"","toolBarFontSize":16,"toolBarFontWeight":"bold"},"siderMenu":{"show":false,"width":0,"backgroundColor":"","color":"","fontSize":16,"fontWeight":"bold","title":"","titleColor":"","titleFontSize":16,"titleFontWeight":"bold"},"tabBar":{"show":false,"backgroundColor":"","color":"","activeColor":"","fontSize":16,"fontWeight":"bold","tabBarItem":[]},"webview":{"userAgent":"","javaScriptEnabled":true,"domStorageEnabled":true,"allowFileAccess":true,"loadWithOverviewMode":true,"setSupportZoom":true,"clearCache":true}},"ios":{"name":"hanime1","showName":"hanime1","version":"0.0.2","webUrl":"https://hanime1.me/","id":"com.hanime1.app.ios","icon":"./app-icon.png","desc":"Package for personal use only, please do not use for commercial purposesï¼ˆæ‰“åŒ…ä»…é™ä¸ªäººä½¿ç”¨ï¼Œè¯·å‹¿ç”¨äºä¼ æ’­æˆ–å•†ä¸šç”¨é€”ï¼‰","pubBody":"Package for personal use only, please do not use for commercial purposesï¼ˆæ‰“åŒ…ä»…é™ä¸ªäººä½¿ç”¨ï¼Œè¯·å‹¿ç”¨äºä¼ æ’­æˆ–å•†ä¸šç”¨é€”ï¼‰","isHtml":false,"debug":false},"android":{"name":"hanime1","showName":"hanime1","version":"0.0.2","webUrl":"https://hanime1.me/","id":"com.hanime1.app.android","icon":"./app-icon.png","input":"./app-icon.png","output":"./res","rounded":true,"copyTo":"./app/src/main/res","androidResDir":"./app/src/main/res","desc":"Package for personal use only, please do not use for commercial purposesï¼ˆæ‰“åŒ…ä»…é™ä¸ªäººä½¿ç”¨ï¼Œè¯·å‹¿ç”¨äºä¼ æ’­æˆ–å•†ä¸šç”¨é€”ï¼‰","pubBody":"Package for personal use only, please do not use for commercial purposesï¼ˆæ‰“åŒ…ä»…é™ä¸ªäººä½¿ç”¨ï¼Œè¯·å‹¿ç”¨äºä¼ æ’­æˆ–å•†ä¸šç”¨é€”ï¼‰","isHtml":false,"debug":false},"desktop":{"name":"hanime1","showName":"hanime1","version":"0.0.2","id":"com.hanime1.app.desktop","desc":"Package for personal use only, please do not use for commercial purposesï¼ˆæ‰“åŒ…ä»…é™ä¸ªäººä½¿ç”¨ï¼Œè¯·å‹¿ç”¨äºä¼ æ’­æˆ–å•†ä¸šç”¨é€”ï¼Œå¦åˆ™åæœè‡ªè´Ÿï¼‰","webUrl":"https://hanime1.me/","iconPath":"../app-icon.png","inputPath":"../app-icon.png","tempPath":"./processed-image.png","icnsPath":"../src-tauri/icons/icon.icns","pubBody":"Package for personal use only, please do not use for commercial purposesï¼ˆæ‰“åŒ…ä»…é™ä¸ªäººä½¿ç”¨ï¼Œè¯·å‹¿ç”¨äºä¼ æ’­æˆ–å•†ä¸šç”¨é€”ï¼Œå¦åˆ™åæœè‡ªè´Ÿï¼‰","isHtml":false,"single":true,"state":true,"injectJq":false,"tauriApi":false,"debug":true,"buildMethod":"cloud"}}